# Decision Log

## 2026-02-23: UI方針を「自作」→「テンプレ改良（framer-motion）」へ転換

### 状況

- main では framer-motion を知らなかったため、これを使わずに、カードUIを自作する方針で進めていた。
- 途中で「ダブルクリックでカード選択→スロットに適用」方向の操作を試していた（作業用ブランチfeature/battle-draggable-cardsで進行）。

### 課題

- 作業用ブランチfeature/battle-draggable-cardsにおいて、ダブルクリックをしてもカードの処理が進まないというバグが発生。カードが光る処理は行われていたため、ダブルクリックの処理自体はされていた。

- カードUIをゼロから実装するのは、座標管理・z-index・ドラッグ判定・演出などの複合難度が高く、学習効率が悪い。
- 成果物の品質も、テンプレをベースにした方が上げやすい。

### 決定

- framer-motion を使ったカードゲーム系テンプレをベースに改造する方針に変更。
- 既存コードは「使える部分は流用する」が、最終的には別物レベルの再構築（rebuild）を前提にする。
- 新しい作業ブランチは `rebuild/framer-motion-edition` とする。

### 理由

- 初心者フェーズでは「既存の良い構造を理解→改造」が最短で身につく。
- 実務でも既存コードの改善・拡張が中心で、経験としても価値が高い。
- UI演出と触感（手触り）を早く良い状態に持っていける。

### 影響範囲

- UIレイヤー：テンプレ構造に合わせて再編（コンポーネント構成の見直し）
- ゲームロジック：テンプレ側に合わせて差し替え／移植
- 以前の途中ブランチは、コードとしては最終形に不要になる可能性が高い（このログで意思決定の流れを保持する）

### 次のアクション

- テンプレを導入し、画面と操作感を最速で成立させる
- 既存の資産（カード定義、効果処理など）を必要に応じて移植

## 2026-02-27: 「コードのステップ実行機能」の実装とメイン統合

### 状況

- プログラミング学習アプリとしての核心である「コードの実行順序と状態変化の可視化」を実装。
- カードプレイ時に、即座に結果を計算するのではなく、コードを1行ずつ読み進める「インタプリタ形式」を採用。

### 決定事項

- データ構造の変更: 単なる文字列だった code プロパティを廃止し、行ごとのイベントを定義できる codeLines 配列を標準とする。
- 実行エンジンの統合: useGame.ts に useEffect を使ったタイマーループを実装し、行ごとのハイライトとゲームイベント（ダメージ、ログ、アニメーション）を同期させる。
- 操作ロック: コード実行中の誤操作を防ぐため、実行中は手札のドラッグやターン終了を無効化する。

### 成果

- 以前のブランチで発生していたカード操作の不安定さが解消。
- ユーザーが「どの行で何が起きたか」を視覚的に理解できるようになった。
- 拡張性が向上（今後 if文や for文などの制御構文を codeLines の操作だけで実装可能）。
